<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LHR Route Map (Leaflet)</title>

<!-- Leaflet CSS/JS (CDN) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  html, body { height: 100%; margin: 0; }
  #map { height: 100vh; width: 100%; }

  /* Top bar */
  .topbar {
    position: absolute; z-index: 9999; left: 12px; right: 12px; top: 12px;
    padding: 10px 12px; border-radius: 12px;
    background: rgba(30,30,30,0.85); color: #fff; backdrop-filter: blur(4px);
    font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
    box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  }
  .title { font-weight: 700; font-size: 16px; }
  .subtitle { opacity: 0.9; font-size: 12px; }

  /* Filters / actions */
  .controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  .badge { background:#2a2a2a; border:1px solid #3a3a3a; border-radius:999px; padding:6px 10px; }
  .btn {
    cursor:pointer; border:none; border-radius:10px; padding:8px 12px;
    background:#0ea5e9; color:#001018; font-weight:700;
  }
  .btn:disabled { opacity: 0.6; cursor: default; }
  .search {
    background:#111; border:1px solid #333; border-radius:10px; color:#fff;
    padding:8px 10px; width: 210px;
  }
  .filters {
    display:flex; gap:8px; flex-wrap:wrap; align-items:center; color:#ddd;
  }
  .filters label { display:flex; gap:6px; align-items:center; background:#1a1a1a; border:1px solid #333; padding:6px 8px; border-radius:8px; cursor:pointer; }

  /* Leaflet attribution smaller, unobtrusive */
  .leaflet-control-attribution { font-size: 11px; }

  /* Popups */
  .popup h3 { margin:0 0 6px; font-size:16px; }
  .popup small { color:#666; }
</style>
</head>
<body>

<div id="map"></div>

<!-- Top overlay bar -->
<div class="topbar">
  <div>
    <div class="title">London Heathrow Route Map</div>
    <div class="subtitle">Click a destination to view details. Use filters to show regions.</div>
  </div>
  <div class="controls">
    <input class="search" id="search" placeholder="Search destination (e.g., Tokyo)" />
    <div class="filters" id="filters">
      <!-- filters are built by JS -->
    </div>
    <button class="btn" id="fitWorld">Fit to World</button>
  </div>
</div>

<script>
  // -----------------------------
  // 1) Base map
  // -----------------------------
  const map = L.map('map', {
    worldCopyJump: true,
    preferCanvas: true
  }).setView([51.4700, -0.4543], 3); // Start zoomed out on LHR

  // Dark tiles similar to Heathrow style
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    subdomains: 'abcd',
    attribution: '&copy; OpenStreetMap, &copy; CARTO'
  }).addTo(map);

  // -----------------------------
  // 2) Icons
  // -----------------------------
  function airportIcon(color = '#0ea5e9') {
    // DivIcon with inline SVG pin
    const svg = encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="34" viewBox="0 0 26 34">
        <path d="M13 0C5.82 0 0 5.82 0 13c0 10.5 13 21 13 21s13-10.5 13-21C26 5.82 20.18 0 13 0z" fill="${color}"/>
        <circle cx="13" cy="13" r="5.5" fill="#0b1220"/>
      </svg>
    `);
    return L.divIcon({
      className: '',
      html: `<img alt="airport" src="data:image/svg+xml;utf8,${svg}">`,
      iconSize: [26, 34],
      iconAnchor: [13, 34],
      popupAnchor: [0, -30]
    });
  }

  const HUB_ICON = airportIcon('#f97316'); // orange for LHR hub
  const DEST_ICON = airportIcon('#0ea5e9'); // blue for destinations

  // -----------------------------
  // 3) Great-circle arc generator
  //    Returns a list of [lat, lon] along the great circle
  // -----------------------------
  function toRad(d) { return d * Math.PI / 180; }
  function toDeg(r) { return r * 180 / Math.PI; }

  function greatCircle(from, to, numPoints = 128) {
    const [lat1, lon1] = from.map(toRad);
    const [lat2, lon2] = to.map(toRad);

    const d = 2 * Math.asin(Math.sqrt(
      Math.sin((lat2 - lat1) / 2) ** 2 +
      Math.cos(lat1) * Math.cos(lat2) * Math.sin((lon2 - lon1) / 2) ** 2
    ));
    if (d === 0) return [from, to];

    const sinD = Math.sin(d);
    const points = [];
    for (let i = 0; i <= numPoints; i++) {
      const f = i / numPoints;
      const A = Math.sin((1 - f) * d) / sinD;
      const B = Math.sin(f * d) / sinD;

      const x = A * Math.cos(lat1) * Math.cos(lon1) + B * Math.cos(lat2) * Math.cos(lon2);
      const y = A * Math.cos(lat1) * Math.sin(lon1) + B * Math.cos(lat2) * Math.sin(lon2);
      const z = A * Math.sin(lat1) + B * Math.sin(lat2);

      const lat = Math.atan2(z, Math.sqrt(x * x + y * y));
      const lon = Math.atan2(y, x);
      points.push([toDeg(lat), toDeg(lon)]);
    }
    return points;
  }

  // -----------------------------
  // 4) Layers and styling helpers
  // -----------------------------
  const allRoutes = L.layerGroup().addTo(map);
  const allMarkers = L.layerGroup().addTo(map);
  const regionGroups = {}; // region -> { routes: LayerGroup, markers: LayerGroup }

  function ensureRegion(name) {
    if (!regionGroups[name]) {
      regionGroups[name] = { routes: L.layerGroup().addTo(map), markers: L.layerGroup().addTo(map) };
    }
    return regionGroups[name];
  }

  function defaultRouteStyle() {
    return { color: '#22d3ee', weight: 1.8, opacity: 0.85 };
  }

  function dimRouteStyle() {
    return { color: '#94a3b8', weight: 1.2, opacity: 0.35 };
  }

  function highlightRouteStyle() {
    return { color: '#f0abfc', weight: 3, opacity: 1 };
  }

  // -----------------------------
  // 5) Hub (LHR)
  // -----------------------------
  const LHR = {
    name: 'London Heathrow',
    iata: 'LHR',
    coords: [51.4700, -0.4543]
  };
  const hubMarker = L.marker(LHR.coords, { icon: HUB_ICON })
    .addTo(allMarkers)
    .bindPopup(`<div class="popup"><h3>${LHR.name} (${LHR.iata})</h3><small>Hub</small></div>`);

  // -----------------------------
  // 6) DESTINATIONS (EDIT HERE)
  //    Add/remove as needed. Regions: Europe, Africa, Americas, Asia, Oceania, Middle East, etc.
  // -----------------------------
  const DESTINATIONS = [
  // -------------------- Europe --------------------
  { "iata": "ABZ", "name": "Aberdeen International Airport", "coords": [57.201, -2.197], "region": "Europe", "country": "UK" },
  { "iata": "AMS", "name": "Amsterdam Schiphol Airport", "coords": [52.308, 4.763], "region": "Europe", "country": "Netherlands" },
  { "iata": "ATH", "name": "Athens International Airport", "coords": [37.936, 23.944], "region": "Europe", "country": "Greece" },
  { "iata": "BCN", "name": "Barcelona El Prat Airport", "coords": [41.297, 2.078], "region": "Europe", "country": "Spain" },
  { "iata": "BSL", "name": "EuroAirport Basel-Mulhouse-Freiburg", "coords": [47.598, 7.529], "region": "Europe", "country": "Switzerland/France" },
  { "iata": "BER", "name": "Berlin Brandenburg Airport", "coords": [52.366, 13.503], "region": "Europe", "country": "Germany" },
  { "iata": "BLQ", "name": "Guglielmo Marconi Airport", "coords": [44.535, 11.292], "region": "Europe", "country": "Italy" },
  { "iata": "BUD", "name": "Budapest Ferenc Liszt International Airport", "coords": [47.436, 19.261], "region": "Europe", "country": "Hungary" },
  { "iata": "BRU", "name": "Brussels Airport", "coords": [50.901, 4.484], "region": "Europe", "country": "Belgium" },
  { "iata": "CPH", "name": "Copenhagen Airport", "coords": [55.617, 12.649], "region": "Europe", "country": "Denmark" },
  { "iata": "DUB", "name": "Dublin Airport", "coords": [53.427, -6.243], "region": "Europe", "country": "Ireland" },
  { "iata": "EDI", "name": "Edinburgh Airport", "coords": [55.95, -3.372], "region": "Europe", "country": "UK" },
  { "iata": "FRA", "name": "Frankfurt Airport", "coords": [50.037, 8.562], "region": "Europe", "country": "Germany" },
  { "iata": "GVA", "name": "Geneva Airport", "coords": [46.238, 6.109], "region": "Europe", "country": "Switzerland" },
  { "iata": "LHR", "name": "London Heathrow Airport", "coords": [51.470, -0.454], "region": "Europe", "country": "UK" },
  { "iata": "MAN", "name": "Manchester Airport", "coords": [53.365, -2.272], "region": "Europe", "country": "UK" },
  { "iata": "ORY", "name": "Paris Orly Airport", "coords": [48.723, 2.379], "region": "Europe", "country": "France" },
  { "iata": "CDG", "name": "Paris Charles de Gaulle Airport", "coords": [49.0097, 2.5479], "region": "Europe", "country": "France" },
  { "iata": "MXP", "name": "Milan Malpensa Airport", "coords": [45.631, 8.723], "region": "Europe", "country": "Italy" },
  { "iata": "LIN", "name": "Milan Linate Airport", "coords": [45.445, 9.276], "region": "Europe", "country": "Italy" },
  { "iata": "MAD", "name": "Madrid Barajas Airport", "coords": [40.472, -3.563], "region": "Europe", "country": "Spain" },
  { "iata": "ZRH", "name": "Zurich Airport", "coords": [47.458, 8.553], "region": "Europe", "country": "Switzerland" },

  // -------------------- Africa --------------------
  { "iata": "ABV", "name": "Nnamdi Azikiwe International Airport", "coords": [9.006, 7.263], "region": "Africa", "country": "Nigeria" },
  { "iata": "ACC", "name": "Kotoka International Airport", "coords": [5.605, -0.205], "region": "Africa", "country": "Ghana" },
  { "iata": "ADD", "name": "Addis Ababa Bole International Airport", "coords": [9.03, 38.8], "region": "Africa", "country": "Ethiopia" },
  { "iata": "ALG", "name": "Houari Boumediene Airport", "coords": [36.691, 3.215], "region": "Africa", "country": "Algeria" },
  { "iata": "CPT", "name": "Cape Town International Airport", "coords": [-33.964, 18.601], "region": "Africa", "country": "South Africa" },
  { "iata": "JNB", "name": "O.R. Tambo International Airport", "coords": [-26.133, 28.242], "region": "Africa", "country": "South Africa" },
  { "iata": "LOS", "name": "Murtala Muhammed International Airport", "coords": [6.577, 3.321], "region": "Africa", "country": "Nigeria" },
  { "iata": "NBO", "name": "Jomo Kenyatta International Airport", "coords": [-1.319, 36.927], "region": "Africa", "country": "Kenya" },
  { "iata": "KGL", "name": "Kigali International Airport", "coords": [-1.968, 30.139], "region": "Africa", "country": "Rwanda" },

  // -------------------- Americas --------------------
  { "iata": "ATL", "name": "Hartsfield–Jackson Atlanta International Airport", "coords": [33.640, -84.427], "region": "Americas", "country": "USA" },
  { "iata": "ORD", "name": "O'Hare International Airport", "coords": [41.974, -87.907], "region": "Americas", "country": "USA" },
  { "iata": "MIA", "name": "Miami International Airport", "coords": [25.793, -80.290], "region": "Americas", "country": "USA" },
  { "iata": "JFK", "name": "John F. Kennedy International Airport", "coords": [40.641, -73.778], "region": "Americas", "country": "USA" },
  { "iata": "BOS", "name": "Logan International Airport", "coords": [42.365, -71.009], "region": "Americas", "country": "USA" },
  { "iata": "CUN", "name": "Cancún International Airport", "coords": [21.036, -86.877], "region": "Americas", "country": "Mexico" },
  { "iata": "YYC", "name": "Calgary International Airport", "coords": [51.130, -114.019], "region": "Americas", "country": "Canada" },
  { "iata": "YUL", "name": "Montréal–Trudeau International Airport", "coords": [45.465, -73.747], "region": "Americas", "country": "Canada" },

  // -------------------- Asia --------------------
  { "iata": "AUH", "name": "Abu Dhabi International Airport", "coords": [24.433, 54.651], "region": "Asia", "country": "UAE" },
  { "iata": "BKK", "name": "Suvarnabhumi Airport", "coords": [13.689, 100.750], "region": "Asia", "country": "Thailand" },
  { "iata": "HKG", "name": "Hong Kong International Airport", "coords": [22.308, 113.918], "region": "Asia", "country": "Hong Kong" },
  { "iata": "DXB", "name": "Dubai International Airport", "coords": [25.253, 55.365], "region": "Asia", "country": "UAE" },
  { "iata": "ICN", "name": "Incheon International Airport", "coords": [37.460, 126.440], "region": "Asia", "country": "South Korea" },
  { "iata": "NRT", "name": "Narita International Airport", "coords": [35.772, 140.392], "region": "Asia", "country": "Japan" },

  // -------------------- Middle East --------------------
  { "iata": "DOH", "name": "Hamad International Airport", "coords": [25.276, 51.613], "region": "Middle East", "country": "Qatar" },
  { "iata": "AMM", "name": "Queen Alia International Airport", "coords": [31.722, 35.993], "region": "Middle East", "country": "Jordan" },
  { "iata": "BAH", "name": "Bahrain International Airport", "coords": [26.270, 50.640], "region": "Middle East", "country": "Bahrain" },
  { "iata": "JED", "name": "King Abdulaziz International Airport", "coords": [21.683, 39.156], "region": "Middle East", "country": "Saudi Arabia" },

  // -------------------- Oceania --------------------
  { "iata": "SYD", "name": "Sydney Kingsford Smith Airport", "coords": [-33.939, 151.175], "region": "Oceania", "country": "Australia" },
  { "iata": "AKL", "name": "Auckland Airport", "coords": [-37.008, 174.789], "region": "Oceania", "country": "New Zealand" },

  // -------------------- Caribbean --------------------
  { "iata": "BGI", "name": "Grantley Adams International Airport", "coords": [13.074, -59.492], "region": "Caribbean", "country": "Barbados" },
  { "iata": "BDA", "name": "L.F. Wade International Airport", "coords": [32.364, -64.678], "region": "Caribbean", "country": "Bermuda" },
  { "iata": "ANU", "name": "V.C. Bird International Airport", "coords": [17.138, -61.792], "region": "Caribbean", "country": "Antigua & Barbuda" }
];
  // Collect regions dynamically
  const REGIONS = [...new Set(DESTINATIONS.map(d => d.region))].sort();

  // -----------------------------
  // 7) Build routes & markers
  // -----------------------------
  const routeByIata = new Map();
  const markerByIata = new Map();
  const featureBounds = L.latLngBounds([LHR.coords]);

  DESTINATIONS.forEach(dest => {
    const grp = ensureRegion(dest.region);

    // Marker
    const marker = L.marker(dest.coords, { icon: DEST_ICON })
      .bindPopup(`
        <div class="popup">
          <h3>${dest.name} (${dest.iata})</h3>
          <div><small>Region:</small> ${dest.region}</div>
          <div><small>Country:</small> ${dest.country || '-'}</div>
          <div style="margin-top:6px;"><small>Route:</small> ${LHR.iata} → ${dest.iata}</div>
        </div>
      `);
    marker.addTo(grp.markers).addTo(allMarkers);
    markerByIata.set(dest.iata, marker);

    // Route (great-circle)
    const arc = greatCircle(LHR.coords, dest.coords, 96);
    const route = L.polyline(arc, defaultRouteStyle())
      .addTo(grp.routes)
      .addTo(allRoutes);
    routeByIata.set(dest.iata, route);

    // Click marker to highlight route
    marker.on('click', () => {
      // Dim all, then highlight this one
      routeByIata.forEach(r => r.setStyle(defaultRouteStyle()));
      route.setStyle(highlightRouteStyle());
    });

    featureBounds.extend(dest.coords);
  });

  // -----------------------------
  // 8) Fit to all
  // -----------------------------
  function fitWorld() {
    map.fitBounds(featureBounds.pad(0.2), { animate: true, duration: 0.7 });
  }
  fitWorld();
  document.getElementById('fitWorld').onclick = fitWorld;

  // -----------------------------
  // 9) Filters UI (regions) + search
  // -----------------------------
  const filtersEl = document.getElementById('filters');
  function buildFilters() {
    // "All" toggle
    const allId = 'f_all';
    const allWrap = document.createElement('label');
    allWrap.innerHTML = `<input type="checkbox" id="${allId}" checked /> All`;
    filtersEl.appendChild(allWrap);

    // Region checkboxes
    REGIONS.forEach((r, idx) => {
      const id = 'f_' + idx;
      const el = document.createElement('label');
      el.innerHTML = `<input type="checkbox" id="${id}" data-region="${r}" checked /> ${r}`;
      filtersEl.appendChild(el);
    });

    // Behavior
    function applyFilters() {
      const allChecked = document.getElementById(allId).checked;
      const regionChecks = Array.from(filtersEl.querySelectorAll('input[data-region]'));
      const activeRegions = new Set(
        regionChecks.filter(c => allChecked || c.checked).map(c => c.dataset.region)
      );

      // Show/hide per region
      Object.entries(regionGroups).forEach(([region, groups]) => {
        const show = activeRegions.has(region);
        if (show) {
          groups.routes.addTo(map);
          groups.markers.addTo(map);
        } else {
          groups.routes.removeFrom(map);
          groups.markers.removeFrom(map);
        }
      });
    }
    filtersEl.addEventListener('change', e => {
      if (e.target && e.target.id === allId) {
        // If "All" toggled, set all others to same
        const v = e.target.checked;
        filtersEl.querySelectorAll('input[data-region]').forEach(c => (c.checked = v));
      } else if (e.target && e.target.hasAttribute('data-region')) {
        // If any region unchecked, uncheck "All"; if all checked, check "All"
        const checks = Array.from(filtersEl.querySelectorAll('input[data-region]'));
        const allOn = checks.every(c => c.checked);
        document.getElementById(allId).checked = allOn;
      }
      applyFilters();
    });

    applyFilters();
  }
  buildFilters();

  // Search (simple name contains)
  const searchInput = document.getElementById('search');
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim().toLowerCase();
    routeByIata.forEach((route, iata) => {
      const dest = DESTINATIONS.find(d => d.iata === iata);
      const match = !q || (dest.name + ' ' + dest.iata + ' ' + (dest.country||'')).toLowerCase().includes(q);
      route.setStyle(match ? defaultRouteStyle() : dimRouteStyle());
      const mk = markerByIata.get(iata);
      if (mk) {
        if (match) { mk.addTo(map); } else { mk.removeFrom(map); }
      }
    });
  });

  // Optional: open hub popup initially
  hubMarker.openPopup();
</script>
</body>
</html>
