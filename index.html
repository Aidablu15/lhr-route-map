<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LHR Route Map (Leaflet)</title>

<!-- Leaflet CSS/JS (CDN) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  html, body { height: 100%; margin: 0; }
  #map { height: 100vh; width: 100%; }

  /* Top bar */
  .topbar {
    position: absolute; z-index: 9999; left: 12px; right: 12px; top: 12px;
    padding: 10px 12px; border-radius: 12px;
    background: rgba(30,30,30,0.85); color: #fff; backdrop-filter: blur(4px);
    font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
    box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  }
  .title { font-weight: 700; font-size: 16px; }
  .subtitle { opacity: 0.9; font-size: 12px; }

  /* Filters / actions */
  .controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  .badge { background:#2a2a2a; border:1px solid #3a3a3a; border-radius:999px; padding:6px 10px; }
  .btn {
    cursor:pointer; border:none; border-radius:10px; padding:8px 12px;
    background:#0ea5e9; color:#001018; font-weight:700;
  }
  .btn:disabled { opacity: 0.6; cursor: default; }
  .search {
    background:#111; border:1px solid #333; border-radius:10px; color:#fff;
    padding:8px 10px; width: 210px;
  }
  .filters {
    display:flex; gap:8px; flex-wrap:wrap; align-items:center; color:#ddd;
  }
  .filters label { display:flex; gap:6px; align-items:center; background:#1a1a1a; border:1px solid #333; padding:6px 8px; border-radius:8px; cursor:pointer; }

  /* Leaflet attribution smaller, unobtrusive */
  .leaflet-control-attribution { font-size: 11px; }

  /* Popups */
  .popup h3 { margin:0 0 6px; font-size:16px; }
  .popup small { color:#666; }
</style>
</head>
<body>

<div id="map"></div>

<!-- Top overlay bar -->
<div class="topbar">
  <div>
    <div class="title">London Heathrow Route Map</div>
    <div class="subtitle">Click a destination to view details. Use filters to show regions.</div>
  </div>
  <div class="controls">
    <input class="search" id="search" placeholder="Search destination (e.g., Tokyo)" />
    <div class="filters" id="filters">
      <!-- filters are built by JS -->
    </div>
    <button class="btn" id="fitWorld">Fit to World</button>
  </div>
</div>

<script>
  // -----------------------------
  // 1) Base map
  // -----------------------------
  const map = L.map('map', {
    worldCopyJump: true,
    preferCanvas: true
  }).setView([51.4700, -0.4543], 3); // Start zoomed out on LHR

  // Dark tiles similar to Heathrow style
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    subdomains: 'abcd',
    attribution: '&copy; OpenStreetMap, &copy; CARTO'
  }).addTo(map);

  // -----------------------------
  // 2) Icons
  // -----------------------------
  function airportIcon(color = '#0ea5e9') {
    // DivIcon with inline SVG pin
    const svg = encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="34" viewBox="0 0 26 34">
        <path d="M13 0C5.82 0 0 5.82 0 13c0 10.5 13 21 13 21s13-10.5 13-21C26 5.82 20.18 0 13 0z" fill="${color}"/>
        <circle cx="13" cy="13" r="5.5" fill="#0b1220"/>
      </svg>
    `);
    return L.divIcon({
      className: '',
      html: `<img alt="airport" src="data:image/svg+xml;utf8,${svg}">`,
      iconSize: [26, 34],
      iconAnchor: [13, 34],
      popupAnchor: [0, -30]
    });
  }

  const HUB_ICON = airportIcon('#f97316'); // orange for LHR hub
  const DEST_ICON = airportIcon('#0ea5e9'); // blue for destinations

  // -----------------------------
  // 3) Great-circle arc generator
  //    Returns a list of [lat, lon] along the great circle
  // -----------------------------
  function toRad(d) { return d * Math.PI / 180; }
  function toDeg(r) { return r * 180 / Math.PI; }

  function greatCircle(from, to, numPoints = 128) {
    const [lat1, lon1] = from.map(toRad);
    const [lat2, lon2] = to.map(toRad);

    const d = 2 * Math.asin(Math.sqrt(
      Math.sin((lat2 - lat1) / 2) ** 2 +
      Math.cos(lat1) * Math.cos(lat2) * Math.sin((lon2 - lon1) / 2) ** 2
    ));
    if (d === 0) return [from, to];

    const sinD = Math.sin(d);
    const points = [];
    for (let i = 0; i <= numPoints; i++) {
      const f = i / numPoints;
      const A = Math.sin((1 - f) * d) / sinD;
      const B = Math.sin(f * d) / sinD;

      const x = A * Math.cos(lat1) * Math.cos(lon1) + B * Math.cos(lat2) * Math.cos(lon2);
      const y = A * Math.cos(lat1) * Math.sin(lon1) + B * Math.cos(lat2) * Math.sin(lon2);
      const z = A * Math.sin(lat1) + B * Math.sin(lat2);

      const lat = Math.atan2(z, Math.sqrt(x * x + y * y));
      const lon = Math.atan2(y, x);
      points.push([toDeg(lat), toDeg(lon)]);
    }
    return points;
  }

  // -----------------------------
  // 4) Layers and styling helpers
  // -----------------------------
  const allRoutes = L.layerGroup().addTo(map);
  const allMarkers = L.layerGroup().addTo(map);
  const regionGroups = {}; // region -> { routes: LayerGroup, markers: LayerGroup }

  function ensureRegion(name) {
    if (!regionGroups[name]) {
      regionGroups[name] = { routes: L.layerGroup().addTo(map), markers: L.layerGroup().addTo(map) };
    }
    return regionGroups[name];
  }

  function defaultRouteStyle() {
    return { color: '#22d3ee', weight: 1.8, opacity: 0.85 };
  }

  function dimRouteStyle() {
    return { color: '#94a3b8', weight: 1.2, opacity: 0.35 };
  }

  function highlightRouteStyle() {
    return { color: '#f0abfc', weight: 3, opacity: 1 };
  }

  // -----------------------------
  // 5) Hub (LHR)
  // -----------------------------
  const LHR = {
    name: 'London Heathrow',
    iata: 'LHR',
    coords: [51.4700, -0.4543]
  };
  const hubMarker = L.marker(LHR.coords, { icon: HUB_ICON })
    .addTo(allMarkers)
    .bindPopup(`<div class="popup"><h3>${LHR.name} (${LHR.iata})</h3><small>Hub</small></div>`);

  // -----------------------------
  // 6) DESTINATIONS (EDIT HERE)
  //    Add/remove as needed. Regions: Europe, Africa, Americas, Asia, Oceania, Middle East, etc.
  // -----------------------------
  const DESTINATIONS = [
    {"iata": "ABZ", "name": "Aberdeen International Airport", "latitude": 57.201, "longitude": -2.197},
  {"iata": "AUH", "name": "Abu Dhabi International Airport", "latitude": 24.433, "longitude": 54.651},
  {"iata": "ABV", "name": "Nnamdi Azikiwe International Airport", "latitude": 9.006, "longitude": 7.263},
  {"iata": "ACC", "name": "Kotoka International Airport", "latitude": 5.605, "longitude": -0.205},
  {"iata": "ADD", "name": "Addis Ababa Bole International Airport", "latitude": 9.03, "longitude": 38.8},
  {"iata": "AMD", "name": "Sardar Vallabhbhai Patel International Airport", "latitude": 23.037, "longitude": 72.634},
  {"iata": "ALG", "name": "Houari Boumediene Airport", "latitude": 36.691, "longitude": 3.215},
  {"iata": "ALA", "name": "Almaty International Airport", "latitude": 43.352, "longitude": 77.040},
  {"iata": "AMM", "name": "Queen Alia International Airport", "latitude": 31.722, "longitude": 35.993},
  {"iata": "AMS", "name": "Amsterdam Airport Schiphol", "latitude": 52.308, "longitude": 4.763},
  {"iata": "ANU", "name": "V. C. Bird International Airport", "latitude": 17.138, "longitude": -61.792},
  {"iata": "EFL", "name": "Kefalonia International Airport", "latitude": 38.249, "longitude": 20.497},
  {"iata": "ATH", "name": "Athens International Airport", "latitude": 37.936, "longitude": 23.944},
  {"iata": "ATL", "name": "Hartsfield-Jackson Atlanta International Airport", "latitude": 33.640, "longitude": -84.427},
  {"iata": "AUS", "name": "Austin–Bergstrom International Airport", "latitude": 30.194, "longitude": -97.669},
  {"iata": "BAH", "name": "Bahrain International Airport", "latitude": 26.270, "longitude": 50.640},
  {"iata": "GYD", "name": "Heydar Aliyev International Airport", "latitude": 40.467, "longitude": 50.046},
  {"iata": "BWI", "name": "Baltimore/Washington International Thurgood Marshall Airport", "latitude": 39.175, "longitude": -76.668},
  {"iata": "BWN", "name": "Brunei International Airport", "latitude": 4.944, "longitude": 114.927},
  {"iata": "BKK", "name": "Suvarnabhumi Airport", "latitude": 13.689, "longitude": 100.750},
  {"iata": "BGI", "name": "Grantley Adams International Airport", "latitude": 13.074, "longitude": -59.492},
  {"iata": "BCN", "name": "Barcelona El Prat Airport", "latitude": 41.297, "longitude": 2.078},
  {"iata": "BSL", "name": "EuroAirport Basel-Mulhouse-Freiburg", "latitude": 47.598, "longitude": 7.529},
  {"iata": "PEK", "name": "Beijing Capital International Airport", "latitude": 40.080, "longitude": 116.584},
  {"iata": "BEY", "name": "Beirut–Rafic Hariri International Airport", "latitude": 33.820, "longitude": 35.821},
  {"iata": "BHD", "name": "George Best Belfast City Airport", "latitude": 54.618, "longitude": -5.872},
  {"iata": "BEG", "name": "Belgrade Nikola Tesla Airport", "latitude": 44.818, "longitude": 20.309},
  {"iata": "BLR", "name": "Kempegowda International Airport", "latitude": 13.198, "longitude": 77.708},
  {"iata": "BER", "name": "Berlin Brandenburg Airport", "latitude": 52.366, "longitude": 13.503},
  {"iata": "BDA", "name": "L.F. Wade International Airport", "latitude": 32.364, "longitude": -64.678},
  {"iata": "BIO", "name": "Bilbao Airport", "latitude": 43.301, "longitude": -2.910},
  {"iata": "BLL", "name": "Billund Airport", "latitude": 55.740, "longitude": 9.150},
  {"iata": "BOG", "name": "El Dorado International Airport", "latitude": 4.701, "longitude": -74.146},
  {"iata": "BLQ", "name": "Guglielmo Marconi Airport", "latitude": 44.535, "longitude": 11.292},
  {"iata": "BDS", "name": "Papola Casale Airport", "latitude": 40.626, "longitude": 17.939},
  {"iata": "BOS", "name": "Logan International Airport", "latitude": 42.365, "longitude": -71.009},
  {"iata": "BRU", "name": "Brussels Airport", "latitude": 50.901, "longitude": 4.484},
  {"iata": "OTP", "name": "Henri Coandă International Airport", "latitude": 44.571, "longitude": 26.102},
  {"iata": "BUD", "name": "Budapest Ferenc Liszt International Airport", "latitude": 47.436, "longitude": 19.261},
  {"iata": "EZE", "name": "Ministro Pistarini International Airport", "latitude": -34.822, "longitude": -58.535},
  {"iata": "CAI", "name": "Cairo International Airport", "latitude": 30.121, "longitude": 31.405},
  {"iata": "YYC", "name": "Calgary International Airport", "latitude": 51.130, "longitude": -114.019},
  {"iata": "CUN", "name": "Cancún International Airport", "latitude": 21.036, "longitude": -86.877},
  {"iata": "CPT", "name": "Cape Town International Airport", "latitude": -33.964, "longitude": 18.601},
  {"iata": "CMN", "name": "Mohammed V International Airport", "latitude": 33.367, "longitude": -7.589},
  {"iata": "CSX", "name": "Changsha Huanghua International Airport", "latitude": 28.190, "longitude": 113.219},
  {"iata": "CHQ", "name": "Chania International Airport", "latitude": 35.215, "longitude": 24.189},
  {"iata": "CLT", "name": "Charlotte Douglas International Airport", "latitude": 35.214, "longitude": -80.943},
  {"iata": "TFU", "name": "Toulouse–Blagnac Airport", "latitude": 43.629, "longitude": 1.383},
  {"iata": "MAA", "name": "Chennai International Airport", "latitude": 13.008, "longitude": 80.209},
  {"iata": "ORD", "name": "O'Hare International Airport", "latitude": 41.974, "longitude": -87.907},
  {"iata": "CVG", "name": "Cincinnati/Northern Kentucky International Airport", "latitude": 39.048, "longitude": -84.667},
  {"iata": "CGN", "name": "Cologne Bonn Airport", "latitude": 50.865, "longitude": 7.142},
  {"iata": "CMB", "name": "Bandaranaike International Airport", "latitude": 7.180, "longitude": 79.884},
  {"iata": "CPH", "name": "Copenhagen Airport", "latitude": 55.617, "longitude": 12.649},
  {"iata": "CFU", "name": "Corfu International Airport", "latitude": 39.601, "longitude": 19.911},
  {"iata": "ORK", "name": "Cork Airport", "latitude": 51.841, "longitude": -8.491},
  {"iata": "DLM", "name": "Dalaman Airport", "latitude": 36.713, "longitude": 28.792},
  {"iata": "DWF", "name": "Dawson City Airport", "latitude": 64.060, "longitude": -139.133},
  {"iata": "DMM", "name": "King Fahd International Airport", "latitude": 26.271, "longitude": 49.797},
  {"iata": "DEN", "name": "Denver International Airport", "latitude": 39.856, "longitude": -104.673},
  {"iata": "LDY", "name": "Lydd Airport", "latitude": 51.042, "longitude": 0.986},
  {"iata": "DTW", "name": "Detroit Metropolitan Airport", "latitude": 42.212, "longitude": -83.353},
  {"iata": "DAC", "name": "Shahjalal International Airport", "latitude": 23.843, "longitude": 90.397},
  {"iata": "DOH", "name": "Hamad International Airport", "latitude": 25.276, "longitude": 51
  ];

  // Collect regions dynamically
  const REGIONS = [...new Set(DESTINATIONS.map(d => d.region))].sort();

  // -----------------------------
  // 7) Build routes & markers
  // -----------------------------
  const routeByIata = new Map();
  const markerByIata = new Map();
  const featureBounds = L.latLngBounds([LHR.coords]);

  DESTINATIONS.forEach(dest => {
    const grp = ensureRegion(dest.region);

    // Marker
    const marker = L.marker(dest.coords, { icon: DEST_ICON })
      .bindPopup(`
        <div class="popup">
          <h3>${dest.name} (${dest.iata})</h3>
          <div><small>Region:</small> ${dest.region}</div>
          <div><small>Country:</small> ${dest.country || '-'}</div>
          <div style="margin-top:6px;"><small>Route:</small> ${LHR.iata} → ${dest.iata}</div>
        </div>
      `);
    marker.addTo(grp.markers).addTo(allMarkers);
    markerByIata.set(dest.iata, marker);

    // Route (great-circle)
    const arc = greatCircle(LHR.coords, dest.coords, 96);
    const route = L.polyline(arc, defaultRouteStyle())
      .addTo(grp.routes)
      .addTo(allRoutes);
    routeByIata.set(dest.iata, route);

    // Click marker to highlight route
    marker.on('click', () => {
      // Dim all, then highlight this one
      routeByIata.forEach(r => r.setStyle(defaultRouteStyle()));
      route.setStyle(highlightRouteStyle());
    });

    featureBounds.extend(dest.coords);
  });

  // -----------------------------
  // 8) Fit to all
  // -----------------------------
  function fitWorld() {
    map.fitBounds(featureBounds.pad(0.2), { animate: true, duration: 0.7 });
  }
  fitWorld();
  document.getElementById('fitWorld').onclick = fitWorld;

  // -----------------------------
  // 9) Filters UI (regions) + search
  // -----------------------------
  const filtersEl = document.getElementById('filters');
  function buildFilters() {
    // "All" toggle
    const allId = 'f_all';
    const allWrap = document.createElement('label');
    allWrap.innerHTML = `<input type="checkbox" id="${allId}" checked /> All`;
    filtersEl.appendChild(allWrap);

    // Region checkboxes
    REGIONS.forEach((r, idx) => {
      const id = 'f_' + idx;
      const el = document.createElement('label');
      el.innerHTML = `<input type="checkbox" id="${id}" data-region="${r}" checked /> ${r}`;
      filtersEl.appendChild(el);
    });

    // Behavior
    function applyFilters() {
      const allChecked = document.getElementById(allId).checked;
      const regionChecks = Array.from(filtersEl.querySelectorAll('input[data-region]'));
      const activeRegions = new Set(
        regionChecks.filter(c => allChecked || c.checked).map(c => c.dataset.region)
      );

      // Show/hide per region
      Object.entries(regionGroups).forEach(([region, groups]) => {
        const show = activeRegions.has(region);
        if (show) {
          groups.routes.addTo(map);
          groups.markers.addTo(map);
        } else {
          groups.routes.removeFrom(map);
          groups.markers.removeFrom(map);
        }
      });
    }
    filtersEl.addEventListener('change', e => {
      if (e.target && e.target.id === allId) {
        // If "All" toggled, set all others to same
        const v = e.target.checked;
        filtersEl.querySelectorAll('input[data-region]').forEach(c => (c.checked = v));
      } else if (e.target && e.target.hasAttribute('data-region')) {
        // If any region unchecked, uncheck "All"; if all checked, check "All"
        const checks = Array.from(filtersEl.querySelectorAll('input[data-region]'));
        const allOn = checks.every(c => c.checked);
        document.getElementById(allId).checked = allOn;
      }
      applyFilters();
    });

    applyFilters();
  }
  buildFilters();

  // Search (simple name contains)
  const searchInput = document.getElementById('search');
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim().toLowerCase();
    routeByIata.forEach((route, iata) => {
      const dest = DESTINATIONS.find(d => d.iata === iata);
      const match = !q || (dest.name + ' ' + dest.iata + ' ' + (dest.country||'')).toLowerCase().includes(q);
      route.setStyle(match ? defaultRouteStyle() : dimRouteStyle());
      const mk = markerByIata.get(iata);
      if (mk) {
        if (match) { mk.addTo(map); } else { mk.removeFrom(map); }
      }
    });
  });

  // Optional: open hub popup initially
  hubMarker.openPopup();
</script>
</body>
</html>
